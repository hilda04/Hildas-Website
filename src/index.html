<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'nonce-hm2024'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self' https://api.allorigins.win https://bvtfd619y9.execute-api.us-east-1.amazonaws.com; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; object-src 'none'; upgrade-insecure-requests" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta http-equiv="Permissions-Policy" content="accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()" />
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
  <title>Hilda Machando — Cloud Security | GRC </title>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* ===== Theme: blue × pink ===== */
    :root{
      --bg:#0b1020;            /* deep navy */
      --ink:#e6edf9;           /* soft ink */
      --muted:#99a7c7;         /* slate-blue */
      --blue:#3b82f6;          /* blue-500 */
      --blue-700:#1d4ed8;      /* blue-700 */
      --pink:#ec4899;          /* pink-500 */
      --pink-700:#be185d;      /* pink-700 */
      --card:#0f1830;          /* dark card */
      --rule:rgba(255,255,255,.12);
      --radius:18px;
      --shadow: 0 24px 60px rgba(2,6,23,.35);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f8fafc; --ink:#0b1020; --muted:#475569; --card:#ffffff; --shadow:0 18px 45px rgba(2,6,23,.08);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      background:
        radial-gradient(1200px 800px at 70% -10%, rgba(59,130,246,.18), transparent 60%),
        radial-gradient(900px 700px at -10% 95%, rgba(236,72,153,.18), transparent 60%),
        var(--bg);
      font: 16px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }

    .wrap{width:min(1000px, 92vw); margin:0 auto; padding: 28px 18px 40px;}

    /* Header + social icons */
    header{display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:18px}
    .brand{display:flex; align-items:center; gap:.75rem}
    .logo{width:36px; height:36px; border-radius:12px; background:linear-gradient(135deg, var(--blue), var(--pink)); box-shadow:0 10px 28px rgba(0,0,0,.25)}
    .title{font-weight:900; letter-spacing:.3px}
    .subtitle{margin-top:-6px; color:var(--muted); font-size:.95rem}

    .social{display:flex; gap:.4rem}
    .icon{display:inline-grid; place-items:center; width:34px; height:34px; border-radius:10px; border:1px solid var(--rule); background:var(--card);
          transition: transform .16s ease, box-shadow .16s ease}
    .icon:hover{transform:translateY(-2px); box-shadow:0 10px 22px rgba(0,0,0,.25)}
    .icon svg{width:18px; height:18px}

    /* Views / router */
    .card{background:var(--card); border:1px solid var(--rule); border-radius:var(--radius); box-shadow:var(--shadow)}
    .view{display:none; padding: clamp(16px, 3vw, 28px)}
    .view.active{display:block; animation: fade .22s ease}
    @keyframes fade{from{opacity:.5; transform:translateY(4px)} to{opacity:1; transform:none}}

    /* Home */
    .home{display:grid; place-items:center; text-align:center; padding: clamp(28px, 5vw, 48px)}
    .intro{display:grid; justify-items:center; gap:1.4rem}
    .portrait{width:160px; height:160px; border-radius:50%; padding:6px; background:linear-gradient(135deg, rgba(59,130,246,.55), rgba(236,72,153,.55)); box-shadow:0 18px 36px rgba(15,24,48,.45); display:grid; place-items:center}
    .portrait-inner{width:100%; height:100%; border-radius:50%; overflow:hidden; background:rgba(15,24,48,.45); display:grid; place-items:center; position:relative}
    .portrait img{width:100%; height:100%; object-fit:cover; display:block}
    .portrait span{position:absolute; inset:0; display:grid; place-items:center; font-weight:900; font-size:2.2rem; letter-spacing:.08em; color:rgba(230,237,249,.92); text-shadow:0 6px 18px rgba(11,16,32,.55); opacity:0; transition:opacity .2s ease}
    .portrait-fallback img{display:none}
    .portrait-fallback span{opacity:1}
    .hero{font-size: clamp(28px, 4.4vw, 42px); line-height:1.08; margin:0}
    .tag{margin:.4rem 0 1.2rem; color:var(--muted)}

    .ctas{display:flex; flex-wrap:wrap; justify-content:center; gap:.75rem}
    .btn{--g:linear-gradient(135deg, var(--blue) 0%, var(--pink) 100%);
         appearance:none; cursor:pointer; font-weight:800;
         padding:.85rem 1.1rem; border-radius:14px; text-decoration:none; display:inline-block;
         border:1px solid var(--rule); background:rgba(255,255,255,.08); color:var(--ink);
         transition:filter .16s ease, box-shadow .16s ease, background .16s ease, color .16s ease, border-color .16s ease}
    @media (prefers-color-scheme: light){
      .btn{background:rgba(255,255,255,.85)}
    }
    .btn.is-active{color:#fff; border:0; background:var(--g);
         box-shadow:0 14px 30px rgba(59,130,246,.25), 0 6px 18px rgba(236,72,153,.18)}
    .btn:hover{filter:brightness(1.05)}

    /* CV view */
    .cv h2{margin:0 0 .6rem}
    .kv{display:grid; gap:.4rem; grid-template-columns: 140px 1fr; border-top:1px dashed var(--rule); padding:.6rem 0}
    .kv:first-of-type{border-top:0}
    .kv .k{color:var(--muted)}
    .chips{margin-top:.5rem}
    .chip{display:inline-block; margin:.2rem .25rem 0 0; padding:.2rem .55rem; border-radius:999px; font-size:.9rem; border:1px solid var(--rule)}

    /* CV enhancements: actions + timeline + print */
    .cv-actions{display:flex; flex-wrap:wrap; gap:.5rem; margin:.5rem 0 1rem}
    .btn-lite{appearance:none; border:1px solid var(--rule); background:linear-gradient(135deg, rgba(59,130,246,.12), rgba(236,72,153,.10)); color:inherit; padding:.55rem .9rem; border-radius:12px; cursor:pointer; font-weight:800}
    .btn-lite:hover{filter:brightness(1.05)}
    .cv-status{margin:1.2rem 0; text-align:center; color:var(--muted);}
    .cv-status.error{color:#f87171;}

    /* Timeline styling */
    .timeline{position:relative; margin-top:.4rem; padding-left:24px}
    .timeline::before{content:""; position:absolute; left:10px; top:0; bottom:0; width:2px; background:linear-gradient(180deg, rgba(59,130,246,.55), rgba(236,72,153,.55))}
    .job-card{position:relative; margin:12px 0; padding:14px; border:1px solid var(--rule); border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0))}
    .job-card::before{content:""; position:absolute; left:3px; top:18px; width:14px; height:14px; border-radius:999px; background: radial-gradient(circle at 35% 35%, #fff 0%, #fff 35%, rgba(59,130,246,1) 36%, rgba(236,72,153,1) 100%); box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .job-card h3{margin:.1rem 0; font-size:1.05rem}
    .job-card .meta{color:var(--muted); font-size:.95rem; margin-bottom:.35rem}
    .job-card ul{margin:.4rem 0 0 1rem}

    /* Print: only CV, preserve colors */
    @media print{
      @page{margin:16mm}
      html,body{background:#fff !important}
      *{-webkit-print-color-adjust:exact; print-color-adjust:exact}
      body.print-cv header, body.print-cv #home, body.print-cv #projects, body.print-cv nav, body.print-cv .social{display:none !important}
      body.print-cv main{padding:0 !important; box-shadow:none}
      body.print-cv .card{border:0; box-shadow:none}
      body.print-cv #cv{display:block !important}
    }

    /* Projects */
    .grid{display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));}
    .proj{padding:16px; border:1px solid var(--rule); border-radius:14px}
    .proj h3{margin:.2rem 0 .2rem}
    .proj p{margin:.2rem 0 .5rem; color:var(--muted)}
    .proj a{color:inherit}

    /* Blog */
    .blog{padding: clamp(20px, 4vw, 32px)}
    .blog-intro{color:var(--muted); margin-top:-.3rem; margin-bottom:1.4rem}
    .blog-list{display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));}
    .blog-card{padding:16px; border:1px solid var(--rule); border-radius:14px; background:linear-gradient(180deg, rgba(59,130,246,.06), rgba(236,72,153,.04)); box-shadow:0 10px 24px rgba(2,6,23,.15)}
    .blog-card h3{margin:.1rem 0 .4rem; font-size:1.05rem}
    .blog-card p{margin:.3rem 0 .6rem; color:var(--muted); font-size:.95rem}
    .blog-card time{display:block; font-size:.85rem; color:var(--muted); margin-bottom:.35rem; font-weight:600}
    .blog-card a{color:inherit; text-decoration:none}
    .blog-card a:hover{text-decoration:underline}
    .blog-card .blog-link{display:inline-flex; align-items:center; gap:.35rem; font-weight:700; color:var(--blue-700); text-decoration:none}
    .blog-card .blog-link:hover{text-decoration:underline}
    .blog-status{margin:0; color:var(--muted)}
    .blog-status.error{color:#f87171}
    .blog-note{margin:1.5rem 0 0; text-align:center; color:var(--muted)}
    .blog-note a{color:var(--blue-700); font-weight:700}

    /* Nav footer */
    nav{display:flex; justify-content:center; gap:.6rem; margin-top:14px}
    nav a{padding:.45rem .8rem; border-radius:12px; border:1px solid var(--rule); background:var(--card); text-decoration:none; color:inherit}
    nav a[aria-current="page"]{outline:2px solid transparent; background:linear-gradient(135deg, rgba(59,130,246,.15), rgba(236,72,153,.12));}

      /* Visitor counter pill (in header, next to icons) */
    .social .counter{display:inline-flex; align-items:center; gap:.35rem; margin-left:.45rem; padding:.22rem .55rem; border-radius:999px; border:1px solid var(--rule); background:linear-gradient(135deg, rgba(59,130,246,.12), rgba(236,72,153,.10)); font-weight:800; font-size:.9rem}
    .social .counter b{color:var(--blue-700)}
  
    /* ==== Scoped CV resume theme & layout ==== */
    .cv .resume{--text:#0f172a;--muted:#475569;--bg:#ffffff;--rule:#e2e8f0;--primary:#1d4ed8;--primary-600:#2563eb;--primary-400:#60a5fa;--accent:#0ea5e9;--ink:#0a2540;--pad:1.25rem;--max:960px;--radius:14px;--shadow:0 6px 24px rgba(2,6,23,.06); color:var(--text)}
    .cv .resume .container{max-width:var(--max); margin:0 auto; padding: calc(var(--pad) * 1.2) var(--pad)}
    .cv .resume .masthead{display:grid; gap:.6rem; padding:calc(var(--pad) * 1.1); border:1px solid var(--rule); border-radius:var(--radius); box-shadow:var(--shadow); background:linear-gradient(180deg, rgba(96,165,250,.12), rgba(14,165,233,.06))}
    .cv .resume .name{font-size:clamp(30px,4.8vw,44px); line-height:1.06; margin:0; letter-spacing:.2px; color:var(--ink)}
    .cv .resume .titles{margin:0; color:var(--muted); font-weight:600}
    .cv .resume .contact{display:flex; flex-wrap:wrap; gap:.6rem .9rem; margin-top:.15rem}
    .cv .resume .contact a{color:var(--primary-600); text-decoration:none; padding:.15rem .35rem; border-radius:8px; background:rgba(37,99,235,.06); border:1px solid rgba(37,99,235,.15)}
    .cv .resume .contact a:hover{background:rgba(37,99,235,.12); border-color:rgba(37,99,235,.35)}
    .cv .resume section{padding: calc(var(--pad) * 1.1) 0}
    .cv .resume h2.section-title{margin:0 0 1rem; font-size:clamp(18px,2.2vw,22px); letter-spacing:.3px; position:relative; padding-left:.85rem; color:var(--ink)}
    .cv .resume h2.section-title::before{content:""; position:absolute; left:0; top:.18em; bottom:.18em; width:5px; border-radius:3px; background:linear-gradient(180deg,var(--primary), var(--accent))}
    .cv .resume .item{display:grid; grid-template-columns: 1fr auto; gap:.35rem 1rem; padding:1rem; border:1px solid var(--rule); border-radius:12px; box-shadow:var(--shadow); background:#fff}
    .cv .resume #experience .item + .item{margin-top:.9rem}
    .cv .resume .role{font-weight:800; margin:0; color:#0b1f44}
    .cv .resume .company{margin:0; color:var(--muted)}
    .cv .resume .date{white-space:nowrap; color:var(--primary-600); font-weight:600}
    .cv .resume .location{color:var(--muted)}
    .cv .resume .bullets{margin:.45rem 0 0 0; padding-left:1.05rem}
    .cv .resume .bullets li{margin:.28rem 0}
    .cv .resume .grid-2{display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))}
    .cv .resume #education .item{box-shadow:none}
    .cv .resume .badge{display:inline-block; border:1px solid rgba(37,99,235,.25); background:rgba(96,165,250,.15); color:#0b3a82; border-radius:999px; padding:.25rem .65rem; margin:.25rem .35rem 0 0; font-size:.92em; font-weight:600}
    .cv .resume a{color:var(--primary-600)}
    .cv .resume a:hover{color:var(--primary)}
    .cv .resume footer{border-top:1px solid var(--rule); padding-top:.75rem; color:var(--muted); font-size:.95em}
    @media (prefers-reduced-motion: no-preference){ .cv .resume .item{transition: transform .18s ease, box-shadow .18s ease} .cv .resume .item:hover{transform: translateY(-2px); box-shadow: 0 12px 32px rgba(2,6,23,.08)} }
    @media print{ .cv .resume .masthead{box-shadow:none; border-color:#000; background:#fff} .cv .resume .item{box-shadow:none} .cv .resume a{color:#000; text-decoration:underline} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">Hilda Machando</div>
          <div class="subtitle">Cloud Security • GRC • Risk</div>
        </div>
      </div>
      <div class="social" aria-label="Social links">
        <!-- LinkedIn -->
        <a class="icon" href="https://linkedin.com/in/hilda-machando-43277b179" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M4.98 3.5A2.5 2.5 0 1 1 5 8.5 2.5 2.5 0 0 1 4.98 3.5zM3 9h4v12H3zM10 9h3.6v1.7h.05c.5-.95 1.75-1.95 3.6-1.95 3.85 0 4.56 2.5 4.56 5.75V21h-4v-5.1c0-1.2 0-2.75-1.7-2.75-1.7 0-2 1.3-2 2.65V21h-4z"/>
          </svg>
        </a>
        <!-- Medium -->
        <a class="icon" href="https://medium.com/@hildamachando4" target="_blank" rel="noopener noreferrer" aria-label="Medium">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M4 18V6l4 6 4-6v12"/>
          </svg>
        </a>
        <!-- Email -->
        <a class="icon" href="mailto:hildamachando4@gmail.com" aria-label="Email">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <rect x="3" y="5" width="18" height="14" rx="2"/>
            <path d="M3 7l9 6 9-6"/>
          </svg>
        </a>
        <!-- <span class="counter" title="Total visits">👀 <b id="visitor-count">—</b></span> -->
      </div>
    </header>

    <!-- Views container -->
    <main class="card">
      <!-- HOME -->
      <section id="home" class="view home active" aria-labelledby="h-home">
        <div class="intro">
          <div class="portrait" data-portrait>
            <div class="portrait-inner">
              <img src="assets/hilda-portrait.png" alt="Portrait of Hilda Machando" loading="lazy" />
              <span aria-hidden="true">HFM</span>
            </div>
          </div>
          <h1 id="h-home" class="hero">Hi, I’m Hilda: I secure clouds and simplify risk.</h1>
          <p class="tag">Explore my CV and projects below.</p>
        </div>
        <div class="ctas">
          <a class="btn" href="#/cv" data-link>📄 View CV</a>
          <a class="btn" href="#/projects" data-link>🧩 View Projects</a>
          <a class="btn" href="#/blog" data-link>✍️ View Blog</a>
        </div>
      </section>

      <!-- CV PAGE -->
      <section id="cv" class="view cv" aria-labelledby="h-cv">
        <h2 id="h-cv">Curriculum Vitae</h2>
        <div class="cv-actions">
          <button class="btn-lite" id="printBtn">🖨️ Print</button>
          <button class="btn-lite" id="pdfBtn">⬇️ Download PDF</button>
        </div>
        <div class="resume" id="cv-embed">
          <p class="cv-status cv-loading">Loading CV…</p>
        </div>
        <nav>
          <a href="#/projects" data-link>Projects</a>
          <a href="#/blog" data-link>Blog</a>
          <a href="#/home" data-link aria-current="page">Home</a>
        </nav>
      </section>

      <!-- PROJECTS PAGE -->
      <section id="projects" class="view projects" aria-labelledby="h-proj">
        <h2 id="h-proj">Projects</h2>
        <div class="grid">
          <article class="proj">
            <h3>Cloud Cost Guard</h3>
            <p>Dashboard + alerts for non‑prod AWS cost spikes and mis‑tagged resources.</p>
            <a href="https://github.com/hilda04/cloud-cost-guard">Repo →</a>
          </article>
          <article class="proj">
            <h3>Risk KPI Board</h3>
            <p>Business‑impact weighted IT risk KPIs with auto status from data sources.</p>
            <a href="/kpidash.html">Case Study →</a>
          </article>
          <article class="proj">
            <h3>Compliance Helper</h3>
            <p>Evidence capture & mapping to ISO/PCI controls for faster audits.</p>
            <a href="/compliancehelper.html"> Case Study + Repo →</a>
          </article>
        </div>
        <nav>
          <a href="#/cv" data-link>CV</a>
          <a href="#/blog" data-link>Blog</a>
          <a href="#/home" data-link aria-current="page">Home</a>
        </nav>
      </section>

      <!-- BLOG PAGE -->
      <section id="blog" class="view blog" aria-labelledby="h-blog">
        <h2 id="h-blog">Latest from the Blog</h2>
        <p class="blog-intro">Here are my newest Medium articles on cloud security, GRC and risk leadership.</p>
        <div class="blog-list" id="blog-posts" aria-live="polite">
          <p class="blog-status">Loading latest posts…</p>
        </div>
        <p class="blog-note">Open Medium to view more → <a href="https://medium.com/@hildamachando4" target="_blank" rel="noopener noreferrer">medium.com/@hildamachando4</a></p>
        <nav>
          <a href="#/cv" data-link>CV</a>
          <a href="#/projects" data-link>Projects</a>
          <a href="#/home" data-link aria-current="page">Home</a>
        </nav>
      </section>
    </main>
  </div>

   <script nonce="hm2024">
    (function(){
      'use strict';

      function safeFetch(url, options = {}) {
        const { headers, ...rest } = options;
        const init = {
          cache: 'no-store',
          credentials: 'omit',
          mode: 'cors',
          ...rest,
          headers: {
            ...(headers || {})
          }
        };
        return fetch(url, init);
      }

      function isSafeUrl(value, element) {
        if (!value) {
          return true;
        }
        const trimmed = value.trim();
        if (!trimmed) {
          return true;
        }
        if (trimmed.startsWith('#')) {
          return true;
        }
        const lower = trimmed.toLowerCase();
        if (lower.startsWith('javascript:') || lower.startsWith('vbscript:')) {
          return false;
        }
        if (lower.startsWith('data:')) {
          return element != null && element.tagName === 'IMG';
        }
        if (/^(mailto:|tel:)/i.test(trimmed)) {
          return true;
        }
        try {
          const parsed = new URL(trimmed, location.origin);
          return parsed.protocol === 'http:' || parsed.protocol === 'https:';
        } catch (error) {
          return false;
        }
      }

      function sanitizeFragment(html) {
        const template = document.createElement('template');
        template.innerHTML = html;

        template.content.querySelectorAll('script, iframe, object, embed').forEach(el => el.remove());

        const walker = document.createTreeWalker(template.content, NodeFilter.SHOW_ELEMENT, null);
        const nodes = [];
        while (walker.nextNode()) {
          nodes.push(walker.currentNode);
        }

        nodes.forEach(node => {
          Array.from(node.attributes).forEach(attr => {
            const name = attr.name.toLowerCase();
            if (name.startsWith('on')) {
              node.removeAttribute(attr.name);
              return;
            }
            if (name === 'src' || name === 'href' || name === 'xlink:href' || name === 'action' || name === 'formaction') {
              if (!isSafeUrl(attr.value, node)) {
                node.removeAttribute(attr.name);
                return;
              }
            }
            if (name === 'target' && attr.value === '_blank') {
              node.setAttribute('rel', 'noopener noreferrer');
            }
          });
        });

        return template.content;
      }

      function createStatusElement(baseClass, message, isError) {
        const el = document.createElement('p');
        el.className = isError ? `${baseClass} error` : baseClass;
        el.textContent = message;
        return el;
      }

      function replaceWithStatus(container, baseClass, message, isError) {
        container.replaceChildren(createStatusElement(baseClass, message, isError));
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('[data-portrait] img').forEach(img => {
          const frame = img.closest('[data-portrait]');
          if (!frame) return;

          const showFallback = () => frame.classList.add('portrait-fallback');
          const clearFallback = () => frame.classList.remove('portrait-fallback');

          img.addEventListener('error', showFallback);
          img.addEventListener('load', () => {
            if (img.naturalWidth === 0) {
              showFallback();
            } else {
              clearFallback();
            }
          });

          if (img.complete) {
            if (img.naturalWidth === 0) {
              showFallback();
            } else {
              clearFallback();
            }
          }
        });
      });

      (function cvLoader(){
        const target = document.getElementById('cv-embed');
        if (!target) return;

        let loaded = false;
        let loadingPromise = null;

        function hashIsCv() {
          const hash = location.hash.replace(/^#\/?/, '');
          return (hash || 'home') === 'cv';
        }

        function load() {
          if (loaded) return Promise.resolve();
          if (loadingPromise) return loadingPromise;

          replaceWithStatus(target, 'cv-status', 'Loading CV…', false);

          loadingPromise = safeFetch('cv.html', { mode: 'same-origin' })
            .then(res => {
              if (!res.ok) throw new Error(`Failed to fetch CV: ${res.status}`);
              return res.text();
            })
            .then(text => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(text, 'text/html');
              let markup = '';
              const resume = doc.querySelector('.container');
              if (resume) {
                markup = resume.outerHTML;
              } else if (doc.body) {
                markup = doc.body.innerHTML;
              } else {
                markup = text;
              }
              const fragment = sanitizeFragment(markup);
              target.replaceChildren(fragment);
              loaded = true;
            })
            .catch(err => {
              console.error(err);
              replaceWithStatus(target, 'cv-status', 'Unable to load CV right now. Please try again later.', true);
              loaded = false;
              throw err;
            })
            .finally(() => {
              loadingPromise = null;
            });

          return loadingPromise;
        }

        function ensureLoaded() {
          load().catch(() => {});
        }

        document.addEventListener('DOMContentLoaded', () => {
          if (hashIsCv()) ensureLoaded();
          document.querySelectorAll('[data-link][href="#/cv"]').forEach(link => {
            link.addEventListener('click', ensureLoaded);
          });
        });

        window.addEventListener('hashchange', () => {
          if (hashIsCv()) ensureLoaded();
        });

        window.__ensureCvLoaded = function() {
          return load().catch(() => {});
        };
      })();

      (function blogLoader(){
        const container = document.getElementById('blog-posts');
        if (!container) return;

        const FEED_URL = 'https://medium.com/feed/@hildamachando4';
        const PROXY_URL = `https://api.allorigins.win/raw?url=${encodeURIComponent(FEED_URL)}`;

        let loaded = false;
        let loadingPromise = null;

        function setStatus(message, isError) {
          replaceWithStatus(container, 'blog-status', message, isError);
        }

        function clean(html) {
          if (!html) return '';
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const text = doc.body ? doc.body.textContent || '' : html;
          return text.replace(/\s+/g, ' ').trim();
        }

        function truncate(text) {
          const max = 180;
          if (text.length <= max) return text;
          return `${text.slice(0, max - 1).trim()}…`;
        }

        function render(items) {
          if (!items.length) {
            setStatus('No posts found yet. Please check back soon.', false);
            return;
          }

          const fragment = document.createDocumentFragment();
          items.forEach(item => {
            const href = isSafeUrl(item.link) ? item.link : '#';

            const article = document.createElement('article');
            article.className = 'blog-card';

            if (item.dateLabel) {
              const time = document.createElement('time');
              if (item.dateISO) time.dateTime = item.dateISO;
              time.textContent = item.dateLabel;
              article.appendChild(time);
            }

            const heading = document.createElement('h3');
            const headingLink = document.createElement('a');
            headingLink.href = href;
            headingLink.target = '_blank';
            headingLink.rel = 'noopener noreferrer';
            headingLink.textContent = item.title;
            heading.appendChild(headingLink);
            article.appendChild(heading);

            if (item.snippet) {
              const paragraph = document.createElement('p');
              paragraph.textContent = item.snippet;
              article.appendChild(paragraph);
            }

            const readLink = document.createElement('a');
            readLink.className = 'blog-link';
            readLink.href = href;
            readLink.target = '_blank';
            readLink.rel = 'noopener noreferrer';
            readLink.textContent = 'Read on Medium →';
            article.appendChild(readLink);

            fragment.appendChild(article);
          });

          container.replaceChildren(fragment);
        }

        function parseFeed(text) {
          const parser = new DOMParser();
          const xml = parser.parseFromString(text, 'application/xml');
          const parseError = xml.querySelector('parsererror');
          if (parseError) throw new Error('Failed to parse feed.');

          return Array.from(xml.querySelectorAll('item')).slice(0, 6).map(item => {
            const title = (item.querySelector('title')?.textContent || 'Untitled').trim();
            const link = (item.querySelector('link')?.textContent || '').trim();
            const pubDate = item.querySelector('pubDate')?.textContent || '';
            const date = pubDate ? new Date(pubDate) : null;
            const description = item.querySelector('description')?.textContent || item.querySelector('content\:encoded')?.textContent || '';
            const snippet = truncate(clean(description));
            const isDateValid = date instanceof Date && !Number.isNaN(date.valueOf());
            const dateLabel = isDateValid ? date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' }) : '';
            const dateISO = isDateValid ? date.toISOString() : '';
            return { title, link: isSafeUrl(link) ? link : '', dateLabel, dateISO, snippet };
          }).filter(item => Boolean(item.link));
        }

        function load() {
          if (loaded) return Promise.resolve();
          if (loadingPromise) return loadingPromise;

          setStatus('Loading latest posts…', false);

          loadingPromise = safeFetch(PROXY_URL)
            .then(res => {
              if (!res.ok) throw new Error(`Failed to fetch feed: ${res.status}`);
              return res.text();
            })
            .then(text => {
              const items = parseFeed(text);
              render(items);
              loaded = true;
            })
            .catch(err => {
              console.error(err);
              setStatus('Unable to load Medium posts right now. Please try again later.', true);
              loaded = false;
              throw err;
            })
            .finally(() => {
              loadingPromise = null;
            });

          return loadingPromise;
        }

        function ensureLoaded() {
          load().catch(() => {});
        }

        function hashIsBlog() {
          const hash = location.hash.replace(/^#\/?/, '');
          return (hash || 'home') === 'blog';
        }

        document.addEventListener('DOMContentLoaded', () => {
          if (hashIsBlog()) ensureLoaded();
          document.querySelectorAll('[data-link][href="#/blog"]').forEach(link => {
            link.addEventListener('click', ensureLoaded);
          });
        });

        window.addEventListener('hashchange', () => {
          if (hashIsBlog()) ensureLoaded();
        });

        window.__ensureBlogLoaded = ensureLoaded;
      })();

      (function router(){
        const views = {
          home: document.getElementById('home'),
          cv: document.getElementById('cv'),
          projects: document.getElementById('projects'),
          blog: document.getElementById('blog')
        };
        const all = Object.values(views);
        const ctas = Array.from(document.querySelectorAll('.ctas [data-link]'));

        function updateCtas(id){
          if (!ctas.length) return;
          ctas.forEach(link => {
            const target = link.getAttribute('href') || '';
            const targetId = target.replace(/^#\/?/, '') || 'home';
            if (targetId === id) {
              link.classList.add('is-active');
            } else {
              link.classList.remove('is-active');
            }
          });
        }

        function activate(id){
          all.forEach(v => v.classList.remove('active'));
          (views[id] || views.home).classList.add('active');
          document.querySelectorAll('nav a').forEach(a=>{
            const isCurrent = a.getAttribute('href') === `#/${id}` || (id==='home' && a.getAttribute('href')==='#/home');
            a.setAttribute('aria-current', isCurrent ? 'page' : 'false');
          });
          updateCtas(id);
          if (id === 'blog' && typeof window.__ensureBlogLoaded === 'function'){
            window.__ensureBlogLoaded();
          }
        }

        function parse(){
          const hash = location.hash.replace('#','');
          const id = (hash.startsWith('/')) ? hash.slice(1) : hash;
          activate(id || 'home');
        }

        window.addEventListener('hashchange', parse);
        document.addEventListener('DOMContentLoaded', parse);

        ctas.forEach(link => {
          const target = link.getAttribute('href');
          if (target === '#/cv') {
            link.addEventListener('click', (event) => {
              const current = location.hash.replace(/^#\/?/, '') || 'home';
              if (current === 'cv') {
                event.preventDefault();
                location.hash = '#/home';
              }
            });
          }
        });
      })();

      (function printControls(){
        function ensureCV(){ if(location.hash !== '#/cv'){ location.hash = '#/cv'; } }
        function doPrint(){
          ensureCV();
          const ready = (typeof window.__ensureCvLoaded === 'function') ? window.__ensureCvLoaded() : Promise.resolve();
          Promise.resolve(ready).finally(() => {
            document.body.classList.add('print-cv');
            setTimeout(()=> window.print(), 50);
          });
        }
        window.addEventListener('afterprint', ()=> document.body.classList.remove('print-cv'));
        document.addEventListener('DOMContentLoaded', ()=>{
          const printBtn = document.getElementById('printBtn');
          const pdfBtn = document.getElementById('pdfBtn');
          if(printBtn) printBtn.addEventListener('click', doPrint);
          if(pdfBtn) pdfBtn.addEventListener('click', doPrint);
        });
      })();

      (function visitorCounter(){
        const el = document.getElementById('visitor-count');
        if(!el) return;

        const COUNTER_API = 'https://bvtfd619y9.execute-api.us-east-1.amazonaws.com/prod/counter';
        const host = location.hostname || 'local';
        let path = location.pathname || '/';
        path = path.replace(/index\.html$/i, '');
        if (!path) path = '/';
        if (!path.startsWith('/')) path = `/${path}`;
        if (path.length > 1) path = path.replace(/\/+$/, '');
        const finalPath = path === '/' ? '' : path;
        const SITE_ID = `${host}${finalPath}`;

        const stampKey = `vc-stamp-${SITE_ID || host}`;
        const today = new Date().toISOString().slice(0,10);
        let shouldHit = true;
        try {
          shouldHit = localStorage.getItem(stampKey) !== today;
        } catch (error) {
          shouldHit = true;
        }

        const url = `${COUNTER_API}?site=${encodeURIComponent(SITE_ID || host)}`;
        const requestOptions = shouldHit ? { method: 'POST' } : { method: 'GET' };

        safeFetch(url, requestOptions)
          .then(r => r.text())
          .then(text => {
            let payload = text;
            if (typeof payload === 'string') {
              try { payload = JSON.parse(payload); } catch (_) { /* noop */ }
            }
            if (payload && typeof payload.body === 'string') {
              try { payload = JSON.parse(payload.body); } catch (_) { /* noop */ }
            } else if (payload && payload.body && typeof payload.body === 'object') {
              payload = payload.body;
            }

            const candidates = [payload];
            if (payload && typeof payload === 'object') {
              candidates.push(payload.count, payload.value, payload.total, payload.visits, payload.Count, payload.Total);
              if (payload.Item) {
                candidates.push(payload.Item.count, payload.Item.value, payload.Item.total, payload.Item.Count, payload.Item.Total);
                if (payload.Item.count && typeof payload.Item.count === 'object') {
                  candidates.push(payload.Item.count.N);
                }
              }
              if (payload.Attributes) {
                candidates.push(payload.Attributes.count, payload.Attributes.value, payload.Attributes.total);
                if (payload.Attributes.count && typeof payload.Attributes.count === 'object') {
                  candidates.push(payload.Attributes.count.N);
                }
              }
              if (Array.isArray(payload.Items)) {
                payload.Items.forEach(item => {
                  if (item && typeof item === 'object') {
                    candidates.push(item.count, item.value, item.total, item.Count, item.Total);
                    Object.values(item).forEach(v => {
                      if (v && typeof v === 'object' && 'N' in v) {
                        candidates.push(v.N);
                      }
                    });
                  }
                });
              }
              if (payload.Item && typeof payload.Item === 'object') {
                Object.values(payload.Item).forEach(v => {
                  if (v && typeof v === 'object' && 'N' in v) candidates.push(v.N);
                });
              }
            }

            const parseNumericString = (str) => {
              if (typeof str !== 'string') return null;
              const cleaned = str.replace(/[,\s]/g, '');
              const direct = Number(cleaned);
              if (Number.isFinite(direct)) return direct;
              const match = str.match(/-?\d[\d,\.\s]*/);
              if (match) {
                const parsed = Number(match[0].replace(/[,\s]/g, ''));
                return Number.isFinite(parsed) ? parsed : null;
              }
              return null;
            };

            let value = null;
            for (const candidate of candidates) {
              if (typeof candidate === 'number' && Number.isFinite(candidate)) {
                value = candidate;
                break;
              }
              if (typeof candidate === 'string') {
                const numeric = parseNumericString(candidate);
                if (numeric !== null) {
                  value = numeric;
                  break;
                }
              }
            }

            el.textContent = (value !== null) ? value.toLocaleString() : '—';
            if(value !== null && shouldHit) {
              try {
                localStorage.setItem(stampKey, today);
              } catch (_) {
                /* ignore storage failures */
              }
            }
          })
          .catch(() => { el.textContent = '—'; });
      })();
    })();
  </script>

</body>
</html>








